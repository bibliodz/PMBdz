// +---------------------------------------------------------------------------------------+
// © 2002-2005 PMB Services / www.sigb.net pmb@sigb.net et contributeurs (voir www.sigb.net)
// +---------------------------------------------------------------------------------------+
// $Id: install.txt,v 1.8 2008-01-28 16:20:18 touraine37 Exp $

+--------------------------------------------------------------------------------+
| Installation de l'application PMB                                              |
|                                                                                |
| PMB v2.1 - Mai 2005                                                            |
+--------------------------------------------------------------------------------+

1 Pré-requis

PMB est une application 3 tiers basé sur un environnement
web classique. Pour fonctionner elle nécéssite :


* Coté serveur :

  * Un serveur web quelconque capable d'intégrer le langage PHP

  * Le langage PHP pour exécuter les scripts

  * Un serveur de base de données MySQL de version supérieure ou égale à 4.0
    

* Coté client :

  * Un navigateur web de génération récente (MS I.E. 6, Netscape 7, ...)
    

* Spécificités du langage PHP requises :

  * Version supérieure ou égale à 4.3

  * Modules impératifs : mysql, gd, xslt, curl

  * Modules optionnels pour activer certaines fonctionnalités
    : yaz pour la recherche z3950, bz2 pour la compression
    directe des sauvegardes.

(pour plus de détails, sous windows, voir le fichier pre_requisite.txt)

2 Installation

Téléchargez la dernière version sur le site de PMB [http://www.sigb.net].
Le fichier est au format d'archive zip (pour windows comme pour linux). 

Extraire l'archive dans le répertoire de votre serveur web
où vous souhaitez installer PMB. Dans la suite du document, 
nous prendrons comme exemple une extraction dans le sous répertoire pmb du répertoire
racine de votre serveur web sur la machine monserveur. 

2.1 Création de la base de données et initialisation de l'application

A partir de l'endroit où vous avez extrait l'archive, appellez
la page tables/install.php (dans notre exemple appellez
l'URL http://monserveur/pmb/tables/install.php).
Cette page vous permet de créer la base de données sur le
serveur MySQL, la remplit avec le minimum requis pour le fonctionnement de PMB et créé l'utilisateur administrateur de
PMB. Deux zones sont à renseigner.

!!!!!!!!!!!!!!!! ATTENTION !!!!!!!!!!!!!!!!! :
SI VOUS N'UTILISEZ PAS CETTE PROCEDURE, PENSEZ A SUPPRIMER LES DEUX FICHIERS
		INSTALL.PHP et INSTALL_REP.PHP
EN PLUS : PENSEZ A CHANGER LE MOT DE PASSE DE L'UTILISATEUR ROOT DE MYSQL
IL EST VIDE PAR DEFAUT, CE QUI CONSTITUE UN TROU EVIDENT.
!!!!!!!!!!!!!!!! ATTENTION !!!!!!!!!!!!!!!!! :
	

2.1.1 Paramètres système

Ce sont les paramètres du serveur MySQL qui seront utilisés
pour créer la base de données. Il est impératif que l'utilisateur
MySQL aie les droits d'administration du serveur pour pouvoir
créer la base de PMB et créer l'utilisateur MySQL de cette
base. Le champ Serveur permet d'indiquer le nom de la machine
hébergeant le serveur MySQL (il peut bien sûr être différent
de la machine hébergeant le serveur web).

2.1.2 Paramètres PMB

Ce sont ces paramètres que le script utilisera pour créer
la base PMB et l'utilisateur MySQL correspondant :

* Utilisateur PMB/Mot de passe : utilisateur MySQL qui sera
  créé pour accéder à la base de PMB

* Base de données PMB : nom de la base de données qui sera
  créée.

* Remplir les tables avec le jeu d'exemples : si vous cochez
  cette case, la base sera remplie avec un jeu d'exemple
  de notices et d'autorités ce qui peut vous permettre de
  tester l'application.

Une fois les paramètres remplis, cliquez sur le bouton Créer
la base.

2.2 Fichiers de configuration de connexion à la base de données

Une fois la base créé, vérifiez les fichiers de configuration
de connexion de PMB à la base de données. Editer le
fichier db_param.inc.php dans le sous répertoire includes
du répertoire d'installation.

Vérifiez la ligne :

define('LOCATION','nom_de_votre_base');

(nom_de_votre_base est le nom saisi dans le champ Base de données PMB de la page d'installation. 
Si vous avez laissé les paramètres par défaut : bibli),

Vérifiez que les paramètres de la section nom_de_votre_base correspond aux
paramètres de connexion de l'installation :

nom_de_votre_base:                // valeurs pour l'accès local

        define('SQL_SERVER', 'chemin_du_serveur');              //nom du serveur

        define('USER_NAME', 'utilisateur_pmb');                   //nom utilisateur

        define('USER_PASS', 'mot_de_passe');                   //mot de passe

        define('DATA_BASE', 'nom_de_votre_base');                   //nom base de données

        break;

Faites la même vérification avec le fichier opac_db_param.incp.php dans opac_css/includes.

2.3 Première connexion

Une fois toutes les opérations précédentes effectuées, vous
pouvez tester la connexion à l'application PMB. Tapez l'adresse
de votre installation dans votre navigateur http://monserveur/pmb

Dans la page de connexion,
connectez vous avec  :

* Utilisateur : admin

* Mot de passe : admin

Si tout s'est bien passé, vous devez avoir la première page
de PMB à l'écran avec en haut 5 onglets dont l'onglet circulation activé. Au centre de la page, 
un champ de saisie du code barres d'un lecteur

Remarque : Lors de la création de la base de données, un
seul utilisateur ayant tous les droits d'aministration est
créé. Cet utilisateur a pour nom Super User, pour login
admin et comme mot de passe admin

2.4 Création du paramétrage et mise à niveau de la base

Afin de conserver la base à jour, après chaque installation ou mise à jour :

* Cliquez sur l'onglet 'Administration'

* dans le menu à gauche de l'écran d'administration, cliquez
  sur Outils puis sur le lien 'Maj base' en haut de l'écran 
  
* Cliquez sur le lien 'cliquez ici pour commencer la mise à jour'

* Cliquez sur poursuivre jusqu'au message 'Votre base est à jour en version vxxx !'
  
3 Changement du mot de passe administrateur

Nous n'aborderons pas dans ce document la gestion des droits
et les différents paramétrages possibles de PMB. Pour cela
reportez vous au Guide de l'administrateur.

Afin de sécuriser l'accès à PMB, la deuxième chose à faire
après l'installation est de modifier le mot de passe de
l'utilisateur admin. 

Cet utilisateur dispose de tous les droits dans PMB et il
porte pour cela le nom par défaut "Super
User". Il n'est pas possible de supprimer cet utilisateur. 


Pour modifier le mot de passe :


1. cliquez sur l'onglet 'Administration' 

2. dans le menu à gauche de l'écran d'administration, cliquez
  sur le lien 'utilisateurs'

3. dans la page de gestion des utilisateurs, cliquez sur le
  lien [mot de passe] de l'utilisateur Super User.

4. saisissez deux fois le nouveau mot de passe que vous souhaitez
  utiliser dans les cases nouveau mot de passe et confirmation

5. enfin cliquez sur le bouton Enregistrer
  

Vous pouvez aussi modifier le login admin et le nom Super
User en cliquant sur le lien admin de l'utilisateur Super
User dans la page de gestion des utilisateurs.

4 Configurations testées

Le logiciel PMB a été testé sur les plateformes suivantes :


* Windows XP avec EeasyPHP 1.6 et 1.7

* Windows 98 avec EasyPHP 1.6 et 1.7

* Windows 2000 server avec IIS/MySQL 3.23

* Linux Mandrake 8.2 avec Apache 1.3.23/ MySQL 3.23

* MacOsX avec Apache/MySQL

Annexes : 
Droits sur le serveur : 
	Afin d'utiliser la possibilité de chargement de fiches UNIMARC
	à partir de l'administration, il faut que le service http de votre
	hébergement dispose des droits d'écriture sur le répertoire admin/import de
	PMB (ce qui est en principe le cas). En outre, votre fichier ne 
	doit pas dépasser une certaine taille (limite d'upload de votre héber-
	geur).
	A défaut, la solution pour les imports de fiches UNIMARC consiste à 
	télécharger le fichier à charger dans le répertoire admin/import de 
	PMB, par FTP par exemple, puis à choisir l'option 
	"préchargement" à partir de la page d'import de l'administration.
	
	Pour pouvoir générer des codes barres, le serveur web doit avoir le droit 
	d'écriture dans le répertoire temp de PMB